<!--for X.PagedList Start-->
@using X.PagedList;
@using X.PagedList.Mvc.Core;
@{
    var pagedList = (IPagedList)ViewBag.PageList;
}
<link href="~/lib/x.paged-list/PagedList.css" rel="stylesheet" type="text/css" />

<link href="~/css/popoStyle.css" rel="stylesheet" type="text/css" />
<script src="~/js/popoLib.js" type="text/javascript"></script>



<link href="~/lib/magicsearch/jquery.magicsearch.css" rel="stylesheet" type="text/css" />
<script src="~/lib/magicsearch/jquery-2.2.3.min.js" type="text/javascript"></script>
<script src="~/lib/magicsearch/jquery.magicsearch.js" type="text/javascript"></script>


<link rel="stylesheet" href="~/lib//jquery-ui-1.12.1/jquery-ui.css">
<script src="~/lib//jquery-ui-1.12.1/jquery-ui.js"></script>

<!--for X.PagedList Edn-->
@{
    ViewData["Title"] = "Index";
}

<h1>Index</h1>


<script>
    //開啟編輯畫面
    function showEdit(workId) {
        //alert(workId);
        $('#showLoadingForEdit').show();

        if (workId != "") {

            //===修改===先藏起來等載完資料再顯示
            $('#editUI').hide();
            CallServerFunction("mesWork/GetWorkData?workID=" + workId, null, loadEditDataComplete);
        }
        else {
            //===新增===清空TextBox
            $('#txtWorkID').val('');
            $('#txtWorkName').val('');
            $('#txtSRNo').val('');
            $('#txtSRTitle').val('');
            //顯示
            $('#showLoadingForEdit').hide();
            $('#editUI').show();
        }

        $('#editPanel').modal('show');
    }

    function loadEditDataComplete(jsonStr) {
        //alert(workData);
        //alert(workData.WorkName);   //注意大小寫有差

        var workData = JSON.parse(jsonStr);
        //注意!! workData 物件成員的大小寫要跟C#物件相符!!
        $('#txtWorkID').val(workData.WorkID);
        $('#txtWorkName').val(workData.WorkName);
        $('#txtDueDate').val(workData.DateDue);

        //alert(workData.OwnerIT);
        //$('#txtOwnerID').trigger('set', { id: '3,4' });

        for (var i = 0; i < dataSource.length; i++) {
            if (dataSource[i].id == "C2043") {
                $("#txtOwnerID").val(dataSource[i].id + ' ' + dataSource[i].notesID);
                break;
            }
        }

        $('#showLoadingForEdit').hide();
        $('#editUI').show();

        //$('#txtOwnerID').trigger('set', { id: '3' }); 無效
    }


</script>



<!-- Create Buttom -->
<input type="button" class="btn btn-primary" value="Create" onclick="showEdit('001'); " />

<!-- Grid Table Start -->
<table class="table1">
    <tr>
        <th>SR No</th>
        <th>Title</th>
        <th>Detail</th>
        <th>IT</th>
        <th>Due</th>
        <th>Status</th>
        <th>Modify</th>
        <th>ID</th>
    </tr>

    @foreach (MESWork item in ViewBag.PageList)
    {
        <tr>

            <td>@Html.DisplayFor(modelItem2 => item.SRNo)</td>
            <td>@Html.DisplayFor(modelItem2 => item.WorkName)</td>
            <td>@Html.DisplayFor(modelItem2 => item.WorkDetail)</td>
            <td>@Html.DisplayFor(modelItem2 => item.OwnerIT)</td>
            <td>@Html.DisplayFor(modelItem2 => item.DateDue)</td>
            <td>@Html.DisplayFor(modelItem2 => item.Status)</td>
            <td><input type="button" class="btn btn-primary" style="font-size: x-small; padding-top: 1px; padding-bottom: 1px;" value="Modify" onclick="showEdit('@item.WorkID'); " /></td>
            <td>@Html.DisplayFor(modelItem2 => item.WorkID)</td>
        </tr>
    }

</table>
<!-- Grid Table End -->
<!--for X.PagedList Start-->
@Html.PagedListPager(pagedList, page => Url.Action("Index", new { page }), X.PagedList.Web.Common.PagedListRenderOptions.Classic)
<!--for X.PagedList End-->

<input type="file" class="multi" accept="gif|jpg" />
<input type="file" multiple
       class="multi maxsize-15120 with-preview" accept="xlsx" />


<!-- 編輯畫面 Start -->
<div id="editPanel" class="modal fade" role="dialog">
    <div class="modal-dialog modal-lg" style="min-width: 90vw !important;">
        <div class="modal-content" style="padding:30px;">

            <div id="showLoadingForEdit">Loading...</div>
            <button id="set-btn" type="button">set a value</button>
            <form method="post" action="mesWork/Edit">
                <table id="editUI">
                    <tr>
                        <th style="padding-right:5px;">WorkID</th>
                        <td><input type="text" value="" style="width:400px; height:25px !important;" id="txtWorkID" readonly /></td>
                    </tr>
                    <tr>
                        <th style="padding-right:5px;">Owner</th>
                        <td>
                            <table style="padding:0;margin:0;">
                                <tr>
                                    <td><input type="text" class="magicsearch" style="width:150px !important; height:25px !important;" id="txtOwnerID" placeholder="search..."></td>
                                    <th style="white-space: nowrap; padding-left: 10px;">User</th>
                                    <td><input type="text" style="width:150px !important; height:25px !important;" id="txtOwnerUser" placeholder="search..."></td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <th style="padding-right:5px;">WorkName</th>
                        <td><input type="text" value="" style="width:600px; height:25px !important;" id="txtWorkName" /></td>
                    </tr>
                    <tr>
                        <th>WorkDetail</th>
                        <td><textarea id="txtWorkDetail" cols="85" rows="6"></textarea></td>
                    </tr>
                    <tr>
                        <th>SR No</th>
                        <td><input type="text" value="" style="height:25px !important;" id="txtSRNo" /></td>
                    </tr>
                    <tr>
                        <th>SR Title</th>
                        <td><input type="text" value="" style="width: 600px; height: 25px !important;" id="txtSRTitle" /></td>
                    </tr>
                    <tr>
                        <th>Due Date</th>
                        <td>
                            <table style="padding:0;margin:0;">
                                <tr>
                                    <td><input type="text" value="" style="width:100px; height:25px !important;" id="txtDueDate" /></td>
                                    <th style="white-space: nowrap; padding-left: 10px;">開始</th>
                                    <td><input type="text" value="" style="width:100px; height: 25px !important;" id="txtStartDate" /></td>
                                    <th style="white-space: nowrap; padding-left:10px;">結束</th>
                                    <td><input type="text" value="" style="width:100px; height: 25px !important;" id="txtEndDate" /></td>
                                </tr>
                            </table>
                        </td>
                    </tr>

                    <tr>
                        <td colspan="2">
                            <input type="submit" value="Save" class="btn btn-success" />
                            <input type="button" value="Cancel" class="btn btn-warning" onclick="$('#editPanel').modal('hide');" />
                        </td>
                    </tr>
                </table>
            </form>
        </div>
    </div>
</div>


<input type="text" id="queryname" name="queryname" />
<input type="text" id="queryid" name="queryid" />
<input type="text" style="width:150px !important; height:25px !important;" id="txtOwnerUser2" placeholder="search...">
<style>
    /*AutoComplete 必加*/
    .ui-autocomplete {
        z-index: 9999 !important;
    }
</style>
<!-- 編輯畫面 End -->
<script>


    $("#txtOwnerUser").autocomplete({
        source: function (request, response) {
            jQuery.get("mesWork/GetMatchUser", {
                query: request.term
            }, function (data) {

                //response(workData);
                //alert(data);
                var data2 = JSON.parse(data);
                //alert(data2);
                response(data2);
                //response($.map(data2, function (item) { // 此處是將返回資料轉換為 JSON物件
                //    //alert(item.label);
                //    return {
                //        label: item.label, // 下拉項顯示內容
                //        value: item.value  // 下拉項對應數值
                //        //另外可以自定義其它引數
                //    }
                //}));
            });
        },
        select: function (event, ui) { //event引數是事件物件，ui物件只有一個item屬性，對應資料來源中被選中的物件
            $("#queryname").val(ui.item.label);
            $("#queryid").val(ui.item.value);
            return false;
        },
        minLength: 2
    });
</script>
<!-- magicsearch -->
<script>
    $.datepicker.setDefaults($.datepicker.regional[""]);
    $("#txtDueDate").datepicker({ dateFormat: 'yy-mm-dd' });
    $("#txtStartDate").datepicker({ dateFormat: 'yy-mm-dd' });
    $("#txtEndDate").datepicker({ dateFormat: 'yy-mm-dd' });

    var dataSource = [
        { id: 'C2043', notesID: 'Potato', cName: '黃群凱' },
        { id: '2', notesID: 'Eric', cName: 'Baker' },
        { id: '3', notesID: 'Victor', cName: 'Brown' },
        { id: '4', notesID: 'Lisa', cName: 'White' },
        { id: '5', notesID: 'Oliver', cName: 'Bull' },
        { id: '6', notesID: 'Zade', cName: 'Stock' },
        { id: '7', notesID: 'David', cName: 'Reed' },
        { id: '8', notesID: 'George', cName: 'Hand' },
        { id: '9', notesID: 'Tony', cName: 'Well' },
        { id: '10', notesID: 'Bruce', cName: 'Wayne' },
    ];
    $('#txtOwnerID').magicsearch({
        dataSource: dataSource,
        fields: ['id', 'notesID', 'cName'],
        id: 'id',
        format: ' %id% %notesID% (%cName%)',
        dropdownBtn: true,
        focusShow: true
    });

    $('#set-btn').click(function () {
        //alert('ss');
        //.val("val2").change();
        //$("#txtOwnerID").val('C2043').trigger("liszt:updated");

        for (var i = 0; i < dataSource.length; i++) {
            if (dataSource[i].id == "C2043") {
                $("#txtOwnerID").val(dataSource[i].id + ' ' + dataSource[i].notesID);
                break;
            }
        }

        //$("#txtOwnerID option[value='C2043']").prop('selected', true);
        //$("#txtOwnerID").val('C2043').change();
        //$('#txtOwnerID').trigger('set', { id: '3' });
        //alert($("#txtOwnerID").val());
        //$("#txtOwnerID option").each(function () {
        //    alert($(this).text());
        //    if ("C2043" === $(this).text()) {
        //        value = $(this).val();
        //    }
        //});
    });
</script>





